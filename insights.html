<!DOCTYPE html>
<html>
<head>
  <title>Sales Insights</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>

<h2>Pipeline Insights</h2>
<div id="stats"></div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAOlXmtbxpPQtB7tZJAW7mo448QMJ4Pn_4",
  authDomain: "mini-crm-9083a.firebaseapp.com",
  projectId: "mini-crm-9083a",
  storageBucket: "mini-crm-9083a.firebasestorage.app",
  messagingSenderId: "529154007688",
  appId: "1:529154007688:web:9a6c18a9c6668a38c7753d"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

db.collection("leads").onSnapshot(snapshot => {
  const stages = {};
  let totalValue = 0;

  snapshot.forEach(doc => {
    const l = doc.data();
    stages[l.stage] = (stages[l.stage] || 0) + 1;
    if (l.stage !== "Lost") totalValue += l.value;
  });

  stats.innerHTML = `
    <p>Total Pipeline Value: â‚¬${totalValue}</p>
    ${Object.keys(stages).map(s => `<p>${s}: ${stages[s]}</p>`).join("")}
  `;
});
</script>

</body>
</html>
